var w=Object.defineProperty;var m=(l,e,t)=>e in l?w(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var o=(l,e,t)=>m(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function v(){const l=["#ff009dff","#26ff00ff","#FF3131","#ffff00ff","#a200ffff","#00BFFF","#FF8C00"];for(let e=l.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[l[e],l[t]]=[l[t],l[e]]}return[l[0],l[1]]}const h={UP:"ArrowUp",DOWN:"ArrowDown",LEFT:"ArrowLeft",RIGHT:"ArrowRight",W:"w",A:"a",S:"s",D:"d"};class u{constructor(e,t,r,i){o(this,"x");o(this,"y");o(this,"dir");o(this,"color");o(this,"trail");o(this,"alive");o(this,"pendingDir");this.x=e,this.y=t,this.dir=r,this.color=i,this.trail=[],this.alive=!0,this.pendingDir=null}setDir(e){e!=={up:"down",down:"up",left:"right",right:"left"}[this.dir]&&(this.pendingDir=e)}step(){this.pendingDir&&(this.dir=this.pendingDir,this.pendingDir=null),this.dir==="up"&&this.y--,this.dir==="down"&&this.y++,this.dir==="left"&&this.x--,this.dir==="right"&&this.x++,this.trail.push([this.x,this.y])}}class S{constructor(e){o(this,"canvas");o(this,"ctx");o(this,"cellSize");o(this,"cols");o(this,"rows");o(this,"running");o(this,"_loop");o(this,"keyHandler");o(this,"grid");o(this,"players");o(this,"mode");this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Canvas not supported");this.ctx=t,this.cellSize=12,this.cols=60,this.rows=40,this.running=!1,this._loop=null,this.keyHandler=this.onKey.bind(this),this.grid=new Map,this.players=[],this.mode=null,this.resize()}resize(){this.canvas.width=this.cols*this.cellSize,this.canvas.height=this.rows*this.cellSize}start(e="1p"){const[t,r]=v();this.mode=e,this.grid=new Map,this.players=[];const i=new u(this.cols-10,Math.floor(this.rows/2),"left",t);if(this.players.push(i),e==="2p"){const s=new u(10,Math.floor(this.rows/2),"right",r);this.players.push(s)}else{const s=new u(10,Math.floor(this.rows/2)+2,"right",r);this.players.push(s)}this.players.forEach(s=>{s.trail=[[s.x,s.y]],s.alive=!0}),window.addEventListener("keydown",this.keyHandler),this.running=!0,this._loop=window.setInterval(()=>this.update(),80)}stop(){this.running=!1,window.removeEventListener("keydown",this.keyHandler),this._loop&&(clearInterval(this._loop),this._loop=null)}onKey(e){const t=e.key,r=this.players[0];if(r&&(t===h.UP&&r.setDir("up"),t===h.DOWN&&r.setDir("down"),t===h.LEFT&&r.setDir("left"),t===h.RIGHT&&r.setDir("right"),this.mode==="2p")){const i=this.players[1];if(!i)return;t===h.W&&i.setDir("up"),t===h.S&&i.setDir("down"),t===h.A&&i.setDir("left"),t===h.D&&i.setDir("right")}}isOccupied(e,t){return this.grid.has(`${e},${t}`)}update(){if(!this.running)return;for(const t of this.players){if(!t.alive)continue;if(t.step(),t.x<0||t.x>=this.cols||t.y<0||t.y>=this.rows){t.alive=!1;continue}const r=`${t.x},${t.y}`;if(this.grid.has(r)){t.alive=!1;continue}this.grid.set(r,!0)}if(this.mode!=="2p"){const t=this.players[1];if(t&&t.alive){const r=["up","down","left","right"],i=t.dir;let s=t.x,n=t.y;if(i==="up"&&n--,i==="down"&&n++,i==="left"&&s--,i==="right"&&s++,s<0||s>=this.cols||n<0||n>=this.rows||this.isOccupied(s,n)){const d=r.filter(a=>{let f=t.x,c=t.y;return a==="up"&&c--,a==="down"&&c++,a==="left"&&f--,a==="right"&&f++,!(f<0||f>=this.cols||c<0||c>=this.rows||this.isOccupied(f,c))});d.length&&t.setDir(d[Math.floor(Math.random()*d.length)])}}}this.draw();const e=this.players.filter(t=>t.alive);e.length<=1&&(this.running=!1,window.removeEventListener("keydown",this.keyHandler),this._loop&&(clearInterval(this._loop),this._loop=null),setTimeout(()=>alert(e.length?"You win!":"All crashed!"),50))}draw(){const e=this.ctx;e.fillStyle="#000",e.fillRect(0,0,this.canvas.width,this.canvas.height);for(const[t]of this.grid){const[r,i]=t.split(",").map(s=>+s);e.fillStyle="#444",e.fillRect(r*this.cellSize,i*this.cellSize,this.cellSize,this.cellSize)}for(const t of this.players){e.fillStyle=t.color;for(const[r,i]of t.trail)e.fillRect(r*this.cellSize,i*this.cellSize,this.cellSize,this.cellSize);t.alive&&(e.fillStyle="#fff",e.fillRect(t.x*this.cellSize,t.y*this.cellSize,this.cellSize,this.cellSize))}}}const p=document.getElementById("game"),y=document.getElementById("startBtn"),g=document.getElementById("modeSelect");if(!p||!y||!g)throw console.error("Missing DOM elements",{canvas:p,startBtn:y,modeSelect:g}),new Error("Required DOM elements not found. Are you running the Vite dev server? (npm run dev)");const D=new S(p);y.addEventListener("click",()=>{const l=g.value;D.start(l)});
